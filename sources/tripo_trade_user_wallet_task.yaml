type: model
materialize: true
connector: athena
refresh:
  cron: '0 2 * * *'
sql: |
  SELECT
    -- 钱包侧字段
    txn_id,
    wallet_id,
    amount,
    (CAST(create_time AS timestamp(3)) - INTERVAL '8' HOUR) AS create_time,
    coalesce((CAST(settle_time AS timestamp(3)) - INTERVAL '8' HOUR) ,(CAST(create_time AS timestamp(3)) - INTERVAL '8' HOUR) )AS settle_time,
    extra,
    wallet_type,
    email,
    domain,
    wallet_sub_type,
    direction,
    txn_type,
    status,
    pt,
    (CAST(updated_at AS timestamp(3)) - INTERVAL '8' HOUR) AS updated_at,
    task_id,
    
    -- 任务侧字段
    task_status,
    task_type,
    client_id,
    (CAST(task_create_time AS timestamp(3)) - INTERVAL '8' HOUR) AS task_create_time,
    (CAST(start_time AS timestamp(3)) - INTERVAL '8' HOUR) AS start_time,
    task_domain,
    running_time,
    pending_time,
    model_version,
    error_code,
    error_message,
    fail_info,
    sub_id,
    task_email,
    (CAST(task_updated_at AS timestamp(3)) - INTERVAL '8' HOUR) AS task_updated_at,
    method_type,
    reason
  FROM gold.tripo_trade_user_wallet_task
  WHERE CAST(DATE_PARSE(pt, '%Y%m%d') AS DATE) >= DATE_ADD('month', -12, CURRENT_DATE)
