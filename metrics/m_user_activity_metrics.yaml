version: 1
type: metrics_view

display_name: User Activity Metrics
model: m_user_activity
timeseries: event_date

dimensions:
  - name: distinct_id
    display_name: User ID
    column: distinct_id

  - name: pt
    display_name: PT
    column: pt

  - name: signup_primary_channel
    display_name: 主要注册渠道
    column: signup_primary_channel

  - name: signup_secondary_channel
    display_name: 次要注册渠道
    column: signup_secondary_channel

  - name: signup_third_channel
    display_name: 第三注册渠道
    column: signup_third_channel

  - name: signup_fourth_channel
    display_name: 第四注册渠道
    column: signup_fourth_channel

  - name: country
    display_name: 国家
    column: country

  - name: signup_device_type
    display_name: 注册设备类型
    column: signup_device_type

  - name: user_type
    display_name: 用户类型
    column: user_type

  - name: payer_type
    display_name: 付费类型
    column: payer_type

  - name: signup_date_be
    display_name: 注册日期(BE)
    column: signup_date_be

  - name: user_type_be
    display_name: 用户类型(BE)
    column: user_type_be

measures:
  - name: total_users
    display_name: 总用户数
    expression: COUNT(DISTINCT distinct_id)
    format_preset: humanize

  - name: total_records
    display_name: 总记录数
    expression: COUNT(*)
    format_preset: humanize

  - name: new_users
    display_name: 新用户数
    expression: SUM(CASE WHEN is_new = 1 THEN 1 ELSE 0 END)
    format_preset: humanize

  - name: active_users
    display_name: 活跃用户数
    expression: SUM(CASE WHEN is_active = 1 THEN 1 ELSE 0 END)
    format_preset: humanize

  - name: generate_model_users
    display_name: 生成模型用户数
    expression: SUM(CASE WHEN is_generate_model = 1 THEN 1 ELSE 0 END)
    format_preset: humanize

  - name: generate_model_3_0_users
    display_name: 3.0生成模型用户数
    expression: SUM(CASE WHEN is_generate_model_by_3_0 = 1 THEN 1 ELSE 0 END)
    format_preset: humanize

  - name: export_model_users
    display_name: 导出模型用户数
    expression: SUM(CASE WHEN is_export_model = 1 THEN 1 ELSE 0 END)
    format_preset: humanize

  - name: payment_users
    display_name: 付费用户数
    expression: SUM(CASE WHEN is_ever_payment_user = 1 THEN 1 ELSE 0 END)
    format_preset: humanize

  - name: pricing_page_users
    display_name: 进入定价页用户数
    expression: SUM(CASE WHEN is_enter_pricing = 1 THEN 1 ELSE 0 END)
    format_preset: humanize

  - name: payment_page_users
    display_name: 进入支付页用户数
    expression: SUM(CASE WHEN is_enter_payment_page = 1 THEN 1 ELSE 0 END)
    format_preset: humanize

  - name: registered_users
    display_name: 注册用户数
    expression: SUM(CASE WHEN is_registed = 1 THEN 1 ELSE 0 END)
    format_preset: humanize

  - name: total_generate_times
    display_name: 总生成次数
    expression: SUM(generate_times)
    format_preset: humanize

  - name: total_generate_times_3_0
    display_name: 3.0总生成次数
    expression: SUM(generate_times_by_3_0)
    format_preset: humanize

  - name: total_export_times
    display_name: 总导出次数
    expression: SUM(export_times)
    format_preset: humanize

  - name: total_subscription_times
    display_name: 总订阅次数
    expression: SUM(subscription_times)
    format_preset: humanize

  - name: total_credit_payment_times
    display_name: 总积分支付次数
    expression: SUM(credit_payment_times)
    format_preset: humanize

  - name: avg_generate_times_per_user
    display_name: 平均每用户生成次数
    expression: AVG(generate_times)
    format_preset: humanize

  - name: avg_export_times_per_user
    display_name: 平均每用户导出次数
    expression: AVG(export_times)
    format_preset: humanize

  - name: retention_1d_rate
    display_name: 1日留存率
    expression: AVG(CASE WHEN retention_1d = 1 THEN 1.0 ELSE 0.0 END)
    format_preset: percentage

  - name: retention_7d_rate
    display_name: 7日留存率
    expression: AVG(CASE WHEN retention_7d = 1 THEN 1.0 ELSE 0.0 END)
    format_preset: percentage

  - name: retention_14d_rate
    display_name: 14日留存率
    expression: AVG(CASE WHEN retention_14d = 1 THEN 1.0 ELSE 0.0 END)
    format_preset: percentage

  - name: retention_30d_rate
    display_name: 30日留存率
    expression: AVG(CASE WHEN retention_30d = 1 THEN 1.0 ELSE 0.0 END)
    format_preset: percentage

  - name: conversion_rate_pricing
    display_name: 定价页转化率
    expression: AVG(CASE WHEN is_enter_pricing = 1 THEN 1.0 ELSE 0.0 END)
    format_preset: percentage

  - name: conversion_rate_payment
    display_name: 支付页转化率
    expression: AVG(CASE WHEN is_enter_payment_page = 1 THEN 1.0 ELSE 0.0 END)
    format_preset: percentage

  - name: payment_conversion_rate
    display_name: 付费转化率
    expression: AVG(CASE WHEN is_ever_payment_user = 1 THEN 1.0 ELSE 0.0 END)
    format_preset: percentage
